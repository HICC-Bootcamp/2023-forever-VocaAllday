<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymleaf.org">
<head>
    <title>signin</title>
    <link href="/css/signin.css" th:href="@{/css/signin.css}" rel="stylesheet">
    <script src="/js/signin.js" th:src="@{/js/signin.js}"></script>
    <script src="https://kit.fontawesome.com/c50c4da782.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

</head>
<body>
<div class="wrapper">
    <form action="/auth/new" id="form" method="post" th:object="${memberFormDto}" onsubmit="return false">

        <div class="signin_box">
            <div class="profile_logo">
                <i class="fa-solid fa-user fa-2x"></i>
            </div>
            <div class="login_title">Welcome!</div>

            <input class="input_box" id="name" type="text" th:field="*{name}" placeholder="이름"
                   onkeypress="changeFocus1()">
            <i class="fa-solid fa-user basicStyle" id="icon_name"></i>
            <div class="error" id="error_name"></div>

            <input class="input_box" id="email" type="email" th:field="*{email}" placeholder="이메일"
                   onkeypress="changeFocus2()">

            <div class="error" id="error_email"></div>

            <input class="input_box" id="password" type="password" th:field="*{password}" placeholder="비밀번호"
                   onkeypress="changeFocus3()">
            <i class="fa-solid fa-eye-slash basicStyle" id="icon_pw1" onclick="viewPw1()"></i>
            <div class="error" id="error_pw1"></div>

            <input class="input_box" id="password_check" type="password" placeholder="비밀번호 확인">
            <i class="fa-solid fa-eye-slash basicStyle" id="icon_pw2" onclick="viewPw2()"></i>
            <div class="error" id="error_pw2"></div>

            <button class="signin_but" id="signin_but" onclick="signin()">가입하기</button>
            <input type="hidden" th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}">
        </div>

    </form>
</div>

<script th:inline="javascript">
/*
    유효성 검사용 정규식
*/
const regex_en = /^[a-z|A-Z]+$/;            //영어
const regex_ko = /^[ㄱ-ㅎ|가-힣]+$/;        //한글
const regex_num = /^[0-9]+$/;               //숫자
const regex_spc = /[~!@#$%^&*()_+|<>?:{}]/; //특수문자

const regex_pw = /^[A-Za-z0-9`~!@#\$%\^&\*\(\)\{\}\[\]\-_=\+\\|;:'"<>,\./\?]{8,16}$/; //비밀번호 : 영어+숫자+특수문자 조합 8~16자
const regex_email = /^[A-Za-z0-9_\.\-]+@[A-Za-z0-9\-]+\.[A-Za-z0-9\-]+/;    //이메일: 알파벳+숫자@알벳+숫자.알파벳+숫자



    //가입하기 기능
const signin = () => {
    let validation = true //가입 조건 통과 여부

    //입력값 받아오기
    let name = document.getElementById('name').value;
    let email = document.getElementById('email').value;
    let pw1 = document.getElementById('password').value;
    let pw2 = document.getElementById('password_check').value;
    let form = document.getElementById("form");

    //입력값 유효성 검사

    if(name===""||name.length>8||(!regex_ko.test(name)&&!regex_en.test(name))){
        //name 입력 오류 : 빈칸 or 8자초과 or 영어나 한글만x
        document.getElementById("error_name").innerText="이름이 올바르지 않습니다."
        validation=false
    }else{
        document.getElementById("error_name").innerText=""
    }

    if(email===""||!regex_email.test(email)){
        //email 입력 오류 : 빈칸 or 알파벳+숫자@알벳+숫자.알파벳+숫자 형식 x
        document.getElementById("error_email").innerText="이메일이 올바르지 않습니다."
        validation=false
    }else{
        document.getElementById("error_email").innerText=""
    }

    if(pw1===""||!regex_pw.test(pw1)){
        document.getElementById("error_pw1").innerText="비밀번호가 올바르지 않습니다."
        validation = false
    }else{
        document.getElementById("error_pw1").innerText=""
    }

    if(pw1 !== pw2){
        document.getElementById("error_pw2").innerText="비밀번호가 일치하지 않습니다."
        validation = false
    }else{
        document.getElementById("error_pw2").innerText=""
    }

    if(validation){
        //유효성 검사 통과
        form.submit();
        ck_duplicate(name)

    }else{
        Swal.fire('회원가입 실패',"회원가입 정보를 확인해주세요!",'error')
    }
}

const ck_duplicate = (name) => {
    let errorMessage = [[${errorMessage}]];
    if (errorMessage != null) {
            alert('회원가입 실패: 이미 가입한 회원입니다!')
    }
}

</script>

</body>
</html>